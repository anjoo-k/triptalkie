<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>북마크 테스트 페이지</title>
</head>
<body>
<h2>북마크 테스트 페이지</h2>

<!-- 로그인된 사용자 (임시) -->
<p>현재 사용자: <span th:text="${memberId}">user1</span></p>

<hr>

<!-- 북마크 리스트 -->
<div th:if="${bookmarks != null}">
    <ul>
        <li th:each="mate : ${bookmarks}">
            <span th:text="${mate.title}">제목</span>
            <img th:src="@{/images/bookmark-off.png}"  
                 th:attr="data-member-id=${memberId}, data-makemate-idx=${mate.idx}"
                 class="bookmarkBtn"
                 style="cursor:pointer; width:24px; height:24px;">
        </li>
    </ul>
</div>

<!-- ✅ 강제 더미 버튼 (bookmarks 없어도 무조건 표시됨) -->
<hr>
<h3>더미 버튼 (테스트용)</h3>
<img src="/images/bookmark-off.png"
     data-member-id="user1"
     data-makemate-idx="999"
     class="bookmarkBtn"
     style="cursor:pointer; width:32px; height:32px;">

<hr>
<p>아이콘 클릭 시 DB에서 state 값이 바뀌고, 이미지가 on/off로 전환됩니다.</p>

<!-- ✅ JS 코드 -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    alert("✅ test.html 실행됨!");  // 페이지 로드 확인용

    const btns = document.querySelectorAll(".bookmarkBtn");
    console.log("📌 북마크 버튼 개수:", btns.length);

    btns.forEach(btn => {
        btn.addEventListener("click", function () {
            console.log("🖱️ 북마크 클릭됨!", this);

            const memberId = this.getAttribute("data-member-id");
            const makemateIdx = this.getAttribute("data-makemate-idx");
            console.log("👉 memberId:", memberId, "👉 makemateIdx:", makemateIdx);

            fetch("/bookmark/toggle", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: `memberId=${memberId}&makemateIdx=${makemateIdx}`
            })
            .then(response => response.json())
            .then(isBookmarked => {
                console.log("📥 서버 응답:", isBookmarked);
                if (isBookmarked) {
                    this.src = "/images/bookmark-on.png";
                } else {
                    this.src = "/images/bookmark-off.png";
                }
            })
            .catch(error => {
                console.error("❌ 북마크 토글 실패:", error);
            });
        });
    });
});
</script>

</body>
</html>
