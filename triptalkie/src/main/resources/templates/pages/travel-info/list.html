<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/base}">
<!-- 여행 정보 게시판 리스트 -->
<main layout:fragment="content">
	<h4 class="text-center content--title"></h4>
	<div class="travel-info-containers bg--containers pt-5 pb-5">
		<!-- 검색 폼 (review 스타일 적용) -->
		<div class="form-container">
			<form th:action="@{/travel-info/list}" method="get" id="searchForm">
				<div class="form-group row">
					<div class="col-sm-10">
						<input type="text" name="title" class="form-control search-box"
							placeholder="무엇을 찾아볼까요?" th:value="${title != null ? title : ''}">
					</div>
					<div class="col-sm-2">
						<button type="submit" class="btn btn-block btn-search">검색</button>
					</div>
				</div>

				<!-- 카테고리 필터 -->
				<div class="form-group row">
					<div class="col-md">
						<select class="form-control select-box mr-2" name="infotype">
							<option value="">여행 정보</option>
							<option value="팁" th:selected="${infotype == '팁'}">팁</option>
							<option value="교통" th:selected="${infotype == '교통'}">교통</option>
							<option value="숙박" th:selected="${infotype == '숙박'}">숙박</option>
							<option value="음식점" th:selected="${infotype == '음식점'}">음식점</option>
							<option value="관광지" th:selected="${infotype == '관광지'}">관광지</option>
							<option value="기타" th:selected="${infotype == '기타'}">기타</option>
						</select>
					</div>

					<div class="col-md">
						<select id="country" name="countryId"
							class="form-control select-box mr-2">
							<option value="">나라 선택</option>
							<option th:each="country : ${countryList}"
								th:value="${country.id}" th:text="${country.name}"
								th:selected="${selectedCountryId != null and country.id == selectedCountryId}"></option>
						</select>
					</div>

					<div class="col-md">
						<select id="city" name="cityId"
							class="form-control select-box mr-2"
							th:data-selected-city="${selectedCityId != null ? selectedCityId : 0}">
							<option value="">도시 선택</option>
						</select>
					</div>
				</div>
			</form>
		</div>

		<div class="board-divider mx-4 px-2"></div>

		<!-- 리스트 -->
		<div class="info-list-container mt-4 mx-4">
			<div th:if="${travelInfoList != null and !travelInfoList.isEmpty()}"
				th:each="map, stat : ${travelInfoList}">
				<div class="card mb-3">
					<div class="card-body card-body-grid">
						<!-- 번호 -->
						<div class="number"
							th:text="${pageData != null && pageData.currentPage != null && pageData.size != null
                        ? (pageData.currentPage - 1) * pageData.size + stat.index + 1
                        : stat.index + 1}">1</div>

						<!-- 오른쪽 컨텐츠 -->
						<div class="right-content">
							<div class="row-badges">
								<span class="badge badge--category" th:text="${map['cityName']}">도시</span>
								<span class="badge--sub-desc"
									th:text="|조회수 · ${map['view'] != null ? map['view'] : 0}|">조회수</span>
							</div>

							<div class="row-stats">
								<a th:href="@{/travel-info/detail/{idx}(idx=${map['idx']})}"
									class="card-title h5 mb-1 title list-title"
									th:text="${map['title'] != null ? map['title'] : '제목 없음'}">글
									제목</a> <span class="badge badge--sub-desc"
									th:text="${map['nickName']}">작성자</span> <span
									class="badge--sub-desc" th:text="${map['createdAtStr']}">2025-08-17</span>
							</div>

							<div class="row-travel-date">
								<span class="badge badge badge--category travel-type"
									th:text="${map['infotype']}">정보종류</span> <span
									class="badge--sub-desc" th:text="${map['infodateStr']}">2025-08</span>
							</div>
						</div>
					</div>
				</div>

				<div class="card-divider" th:if="${!stat.last}"></div>
			</div>

			<!-- 리스트 없을 때 -->
			<div th:if="${travelInfoList == null or travelInfoList.isEmpty()}"
				class="text-center py-4">검색 결과가 없습니다.</div>
		</div>

		<!-- 페이지네이션 + 글쓰기 버튼 -->
		<div class="row mb-3">
			<div class="col"></div>

			<!-- 가운데 페이지네이션 -->
			<div class="col-6 text-center"
				th:if="${pageData != null and pageData.totalPage > 0}">
				<nav class="p-2 pagination--bottom">
					<ul class="pagination justify-content-center mb-0">
						<!-- 처음으로 -->
						<li class="page-item pagination--spacing"
							th:classappend="${pageData.currentPage == 1} ? 'disabled'">
							<a class="page-link"
							th:href="@{/travel-info/list(
                                title=${title},
                                infotype=${infotype},
                                cityId=${cityId},
                                countryId=${selectedCountryId},
                                page=1,
                                size=${pageData.size})}">&laquo;</a>
						</li>

						<!-- 이전 -->
						<li class="page-item pagination--spacing"
							th:classappend="${pageData.currentPage == 1} ? 'disabled'">
							<a class="page-link"
							th:href="@{/travel-info/list(
                                title=${title},
                                infotype=${infotype},
                                cityId=${cityId},
                                countryId=${selectedCountryId},
                                page=${pageData.currentPage > 1 ? pageData.currentPage - 1 : 1},
                                size=${pageData.size})}">&lt;</a>
						</li>

						<!-- 페이지 번호 반복 -->
						<li class="page-item pagination--spacing"
							th:each="i : ${#numbers.sequence(pageData.startPage > 0 ? pageData.startPage : 1, pageData.endPage)}"
							th:classappend="${i == pageData.currentPage} ? 'active'"><a
							class="page-link"
							th:href="@{/travel-info/list(
                                title=${title},
                                infotype=${infotype},
                                cityId=${cityId},
                                countryId=${selectedCountryId},
                                page=${i},
                                size=${pageData.size})}"
							th:text="${i}">1</a></li>

						<!-- 다음 -->
						<li class="page-item pagination--spacing"
							th:classappend="${pageData.currentPage == pageData.totalPage} ? 'disabled'">
							<a class="page-link"
							th:href="@{/travel-info/list(
                                title=${title},
                                infotype=${infotype},
                                cityId=${cityId},
                                countryId=${selectedCountryId},
                                page=${pageData.currentPage < pageData.totalPage ? pageData.currentPage + 1 : pageData.totalPage},
                                size=${pageData.size})}">&gt;</a>
						</li>

						<!-- 마지막 -->
						<li class="page-item pagination--spacing"
							th:classappend="${pageData.currentPage == pageData.totalPage} ? 'disabled'">
							<a class="page-link"
							th:href="@{/travel-info/list(
                                title=${title},
                                infotype=${infotype},
                                cityId=${cityId},
                                countryId=${selectedCountryId},
                                page=${pageData.totalPage},
                                size=${pageData.size})}">&raquo;</a>
						</li>
					</ul>
				</nav>
			</div>

			<!-- 검색 결과 없을 때 메시지 -->
<!-- 			<div th:if="${pageData == null or pageData.totalPage == 0}"
				class="col-6 text-center p-3">검색 결과가 없습니다.</div> -->

			<!-- 오른쪽 글쓰기 버튼 -->
			<div
				class="col d-flex justify-content-center align-items-center mt-1">
				<a class="btn btn-write" th:href="@{/travel-info/register}"> <svg
						xmlns="http://www.w3.org/2000/svg" width="16" height="16"
						fill="currentColor" class="bi bi-pencil-square"
						viewBox="0 0 16 16">
            <path
							d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"></path>
            <path fill-rule="evenodd"
							d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"></path>
          </svg>
				</a>
			</div>
		</div>
	</div>
	<input type="hidden" name="page" value="1">


	<script th:src="@{/js/travel-info.js}"></script>
</main>
</html>
