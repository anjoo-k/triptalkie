<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.walkietalkie.triptalkie.mapper.TravelReviewCommentMapper">
	<!-- 댓글 등록 -->
	<insert id="registerComment"
		parameterType="com.walkietalkie.triptalkie.DTO.TravelReviewCommentDTO"
		useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO travelreview_comment
		(travelreview_idx, content, member_id, created_at,
		updated_at)
		VALUES
		(#{travelReviewIdx}, #{content},
		#{memberId}, NOW(), NOW())
	</insert>

	<!-- 게시글 번호로 댓글 리스트 전체 조회 -->
	<select id="findAllReplyByIdx"
		resultType="com.walkietalkie.triptalkie.DTO.TravelReviewCommentDTO">
		SELECT
		c.idx,
		c.travelreview_idx AS travelReviewIdx,
		c.member_id AS memberId,
		m.nickname AS nickName,
		c.content,
		c.created_at
		AS createdAt,
		c.updated_at AS updatedAt
		FROM travelreview_comment c
		JOIN
		member m ON c.member_id = m.id
		WHERE c.travelreview_idx =
		#{travelReviewIdx}
		ORDER BY c.created_at DESC
	</select>

	<!-- 댓글 번호로 댓글 조회 -->
	<select id="findByIdx"
		resultType="com.walkietalkie.triptalkie.DTO.TravelReviewCommentDTO">
		SELECT
		c.idx,
		c.travelreview_idx AS travelReviewIdx,
		c.member_id AS memberId,
		m.nickname AS nickName,
		c.content,
		c.created_at
		AS createdAt,
		c.updated_at AS updatedAt
		FROM travelreview_comment c
		JOIN
		member m ON c.member_id = m.id
		WHERE c.idx = #{idx}
		ORDER BY
		c.created_at DESC
	</select>

	<!-- 댓글 수정 -->
	<update id="updateCommentByIdx" parameterType="com.walkietalkie.triptalkie.DTO.TravelReviewCommentDTO">
		UPDATE travelreview_comment
		SET content = #{content},
		updated_at = NOW()
		WHERE idx = #{idx}
	</update>

	<!-- 댓글 삭제 -->
	<delete id="deleteCommentByIdx">
		DELETE FROM travelreview_comment
		WHERE idx = #{idx}
	</delete>
</mapper>