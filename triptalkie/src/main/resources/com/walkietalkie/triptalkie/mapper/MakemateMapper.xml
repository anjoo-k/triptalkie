<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.walkietalkie.triptalkie.mapper.MakemateMapper">
	<select id="countMakemate" resultType="int">
		SELECT COUNT(*)
		FROM
		makemate;
	</select>
	<!-- 목록 조회 -->
	<select id="findMakematesAllList">
		SELECT idx, title, content, state, created_at,
		updated_at, startdate, enddate, city_id, member_id, concept_type
		FROM
		makemate
		ORDER BY created_at
		LIMIT #{size} OFFSET #{offset}
	</select>
	<!-- id로 멤버 조회 -->
	<select id="findMemberById">
		SELECT nickname, birth, gender, address
		FROM member
		WHERE
		id=#{memberId}
	</select>
	<!-- idx로 도시 조회 -->
	<select id="findCityByIdx">
		SELECT id, name, country_id
		FROM city
		WHERE id=#{cityId}
	</select>
	<!-- idx로 나라 조회 -->
	<select id="findCountryByIdx">
		SELECT id, name, land_id
		FROM country
		WHERE id=#{countryId}
	</select>
	<!-- idx로 대륙 조회 -->
	<select id="findLandByIdx">
		SELECT id, name
		FROM land
		WHERE id=#{landId}
	</select>
	<!-- idx로 makemate 조회 -->
	<select id="findMakemateByIdx">
		SELECT idx, title, content, state, created_at,
		updated_at, 
		view, matetype, max_people, budget, state,
		startdate,
		enddate, city_id, member_id, concept_type
		FROM makemate
		WHERE idx=#{idx}
	</select>
	<!-- 조회수 증가 -->
	<update id="increaseViewCount">
		UPDATE makemate
		SET view = view + 1
		WHERE idx=#{id}
	</update>
	<select id="findCountMemberByIdx">
		SELECT COUNT(*)
		FROM memberlist
		WHERE makemate_idx=#{idx}
	</select>

	<!-- 사진만 내려주면 되나? <select id="findMemberListByIdx"> SELECT ml.makemate_idx, 
		ml.member_id FROM memberlist ml JOIN makemate mm ON (mm.idx = ml.makemate_idx) 
		JOIN member m ON (mm.member_id = m.id) WHERE mm.idx=1; </select> -->
</mapper>