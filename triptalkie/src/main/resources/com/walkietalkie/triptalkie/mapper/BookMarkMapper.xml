<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.walkietalkie.triptalkie.mapper.BookMarkMapper">

	<!--북마크 추가 -->
	<insert id="insertBookmark">
		INSERT INTO bookmark (member_id, makemate_idx)
		VALUES
		(#{memberId},#{makemateIdx})
	</insert>

	<!--북마크 여부 조회 -->
	<select id="existBookmark" resultType="java.lang.Integer">
		select state
		from
		bookmark
		where member_id=#{memberId}
		and makemate_idx= #{makemateIdx}
	</select>
	<!--북마크 삭제 -->
	<delete id="deleteBookmark">
		DELETE FROM bookmark
		WHERE member_id = #{memberId}
		AND
		makemate_idx = #{makemateIdx}

	</delete>

	<!--북마크 리스트 조회 -->
	<select id="findBookmarksWithMakemate"
		resultType="com.walkietalkie.triptalkie.DTO.BookmarkDTO">
		SELECT
		b.idx AS bookmarkIdx,
		m.idx AS makemateIdx,
		m.title AS
		title,
		m.content AS content,
		m.startdate AS startdate,
		m.enddate AS
		enddate,
		m.concept_type AS conceptType,
		m.matetype AS matetype,
		m.age_group AS ageGroup,
		m.budget AS budget,
		m.state AS state,
		mem.id AS
		memberId,
		mem.nickname AS memberNickname,
		mem.gender AS memberGender,
		c.id AS cityId,
		c.name AS cityName,
		ct.id AS countryId,
		ct.name AS
		countryName,
		l.id AS landId,
		l.name AS landName
		FROM bookmark b
		JOIN
		makemate m ON b.makemate_idx = m.idx
		JOIN member mem ON m.member_id =
		mem.id
		JOIN city c ON m.city_id = c.id
		JOIN country ct ON c.country_id =
		ct.id
		JOIN land l ON ct.land_id = l.id
		WHERE b.member_id = #{memberId}
		ORDER BY b.created_at DESC
	</select>


	<!-- 북마크 상태 업데이트 -->
	<update id="updateBookmarkState">
		UPDATE bookmark
		SET state = #{state}
		WHERE member_id =
		#{memberId}
		AND makemate_idx = #{makemateIdx}
	</update>

	<!-- 북마크 총 개수 조회 (활성된 것만) -->
	<select id="countBookmarks" resultType="int">
		SELECT COUNT(*)
		FROM bookmark
		WHERE member_id = #{memberId}
		AND state = 1
	</select>


</mapper>